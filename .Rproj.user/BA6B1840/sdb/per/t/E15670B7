{
    "collab_server" : "",
    "contents" : "library(tidyverse)\nlibrary(readxl)\nlibrary(stringr)\nlibrary(forcats)\n\n#---------------------#\n# SCORES SPOT BY SPOT #\n#---------------------#\n\nDF_SCORES <- read_excel(\"IGF1R UTUC.xlsx\", sheet = 3)\n\n# Replacing white spaces in colnames for underscores\ncolnames(DF_SCORES) <- str_replace_all(colnames(DF_SCORES), \" \", \"_\")\n\n# Selecting only columns of interest\nDF_SCORES <- DF_SCORES %>% \n    select(case_code, H_score, HER2_score)\n\nDF_SCORES <- DF_SCORES %>% \n    mutate(\n        id = str_replace_all(case_code, \"-?[0-9]?[0-9]?[NT]\", \"\"),\n        id = factor(fct_recode(id, \"H0101974\" = \"H0101974-(8-10)\")),\n        tissue = str_replace_all(case_code, \".*N\", \"Nontumor\"),\n        tissue = factor(str_replace_all(tissue, \".*T\", \"Tumor\"))\n    )\n\n#----------------------------------------------------------------#\n# CLINICOPATHOLOGIC AND OUTCOME FEATURES WITH AVG AND MAX SCORES #\n#----------------------------------------------------------------#\n\nDF <- read_excel(\"IGF1R UTUC.xlsx\", sheet = 1)\n\n# Replacing characters in colnames for underscores\ncolnames(DF) <- str_replace_all(colnames(DF), \"[ :;=_]\", \"\")\ncolnames(DF) <- str_replace_all(colnames(DF), \"-\", \"\")\n\n# Tidying the dataframe\nDF <- DF %>% \n    # Removing unnecesary columns\n    select(\n        -(avg0:highesther2score1),\n        -outcomeLFU0DOD1DOC2NED3AWD,\n        -ProgressionotherthanBtrecurrenceno0yes1,\n        -fumoprogotherthanbtrec) %>% \n    # Renaming data columns\n    rename(\n        id = casecode,\n        sex = gender0male1female,\n        location = location0pelvis1ureter2pelvisureter,\n        pt = ptpTa0pT11pT22pT33pT44,\n        high_pt = highptno0yes1,\n        high_grade = highgradeno0yes1,\n        lymph_nodes = lymphno0yes1,\n        lvi = lvino0yes1,\n        recurrence = Btrecurrenceno0yes1,\n        fu_recurrence = fumobtrec,\n        progression = progressionno0yes1,\n        fu_progression = fumoprog,\n        dod = dodno0yes1\n    ) %>% \n    # Tidying data columns\n    mutate(\n        sex = fct_recode(factor(sex),\n            \"Male\" = \"0\",\n            \"Female\" = \"1\"\n        ),\n        location = fct_recode(factor(location),\n            \"Pelvis\" = \"0\",\n            \"Ureter\" = \"1\",\n            \"Pelvis-ureter\" = \"2\"\n        ),\n        pt = fct_recode(factor(pt, levels = c(as.character(0:4))),\n            \"pTa\" = \"0\",\n            \"pT1\" = \"1\",\n            \"pT2\" = \"2\",\n            \"pT3\" = \"3\",\n            \"pT4\" = \"4\"\n        ),\n        high_pt = fct_recode(factor(high_pt, levels = c(\"0\", \"1\")),\n            \"Low pT (pT0-pT2)\" = \"0\",\n            \"High pT (pT3-pT4)\" = \"1\"\n        ),\n        grade = factor(grade, levels = c(\"Grade 1\", \"Grade 2\", \"Grade 3\")),\n        high_grade = fct_recode(factor(high_grade, levels = c(\"0\", \"1\")),\n            \"Low grade\" = \"0\",\n            \"High grade\" = \"1\"\n        ),\n        lymph_nodes = fct_recode(factor(lymph_nodes, levels = c(\"0\", \"1\")),\n            \"No Lymph node metastasis\" = \"0\",\n            \"Lymph node mestastasis\" = \"1\"\n        ),\n        lvi = fct_recode(factor(lvi, levels = c(\"0\", \"1\")),\n            \"No lymphovascular invasion\" = \"0\",\n            \"Lymphovascular invasion\" = \"1\"\n        ),\n        recurrence = fct_recode(factor(recurrence, levels = c(\"0\", \"1\")),\n            \"No tumor recurrence\" = \"0\",\n            \"Tumor recurrence\" = \"1\"\n        ),\n        progression = fct_recode(factor(progression, levels = c(\"0\", \"1\")),\n            \"No tumor progression\" = \"0\",\n            \"Tumor progression\" = \"1\"\n        ),\n        outcome = factor(outcome),\n        dod = fct_recode(factor(dod, levels = c(\"0\", \"1\")),\n            \"NED + AWD + DOC + LFU\" = \"0\",\n            \"DOD\" = \"1\"\n        ),\n        dead = fct_collapse(factor(outcome),\n            \"NED + AWD + LFU\" = c(\"NED\", \"AWD\", \"LFU\"),\n            \"DOC + DOD\" = c(\"DOC\", \"DOD\")\n        ),\n        age_group = factor(ifelse(\n            age > median(age, na.rm = TRUE), \"Older group\", \"Younger group\"\n        ), levels = c(\"Younger group\", \"Older group\"))\n    )\n\n# Creating intermediate dataframes for markers summarized values\n# H-scores\nH_median <- DF_SCORES %>% \n    group_by(id, tissue) %>% \n    summarize(H_median = median(H_score, na.rm = TRUE)) %>% \n    spread(tissue, H_median) %>% \n    rename(tumor_h_median = Tumor, nontumor_h_median = Nontumor)\n\nH_max <- DF_SCORES %>% \n    group_by(id, tissue) %>% \n    summarize(H_max = max(H_score, na.rm = TRUE)) %>% \n    spread(tissue, H_max) %>% \n    rename(tumor_h_max = Tumor, nontumor_h_max = Nontumor)\n\nH_scores <- merge(H_median, H_max)\n\n# HER2 scores\nHER2_median <- DF_SCORES %>% \n    group_by(id, tissue) %>% \n    summarize(HER2_median = median(HER2_score, na.rm = TRUE)) %>% \n    spread(tissue, HER2_median) %>% \n    rename(tumor_her2_median = Tumor, nontumor_her2_median = Nontumor)\n\nHER2_max <- DF_SCORES %>% \n    group_by(id, tissue) %>% \n    summarize(HER2_max = max(HER2_score, na.rm = TRUE)) %>% \n    spread(tissue, HER2_max) %>% \n    rename(tumor_her2_max = Tumor, nontumor_her2_max = Nontumor)\n\nHER2_scores <- merge(HER2_median, HER2_max)\n\n# H + HER2 scores\nscores <- merge(H_scores, HER2_scores)\n\n# Appending scores to dataframe\nDF <- merge(DF, scores)\n\n# Categorizing IGF1R expression levels\nDF <- DF %>% \n    mutate(\n        h_group_median = factor(ifelse(\n            tumor_h_median > median(tumor_h_median, na.rm = TRUE),\n            \"High IGF1R\", \"Low IGF1R\"\n        ), levels = c(\"Low IGF1R\", \"High IGF1R\")\n        ),\n        h_group_max = factor(ifelse(\n            tumor_h_max > median(tumor_h_max, na.rm = TRUE),\n            \"High IGF1R\", \"Low IGF1R\"\n        ), levels = c(\"Low IGF1R\", \"High IGF1R\")\n        ),\n        her2_group_median = factor(ifelse(\n            tumor_her2_median > median(tumor_her2_median, na.rm = TRUE),\n            \"High IGF1R\", \"Low IGF1R\"\n        ), levels = c(\"Low IGF1R\", \"High IGF1R\")\n        ),\n        her2_group_max = factor(ifelse(\n            tumor_her2_max > median(tumor_her2_max, na.rm = TRUE),\n            \"High IGF1R\", \"Low IGF1R\"\n        ), levels = c(\"Low IGF1R\", \"High IGF1R\")\n        )\n    )\n\n# Removing intermediate objects\nintermediate <- c(\"H_median\", \"H_max\", \"H_scores\", \"HER2_median\", \"HER2_max\", \"HER2_scores\", \"scores\")\nrm(list = intermediate)\n\nsave(DF, DF_SCORES, file = \"DF.Rdata\")",
    "created" : 1490715320230.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "780171077",
    "id" : "E15670B7",
    "lastKnownWriteTime" : 1490718939,
    "last_content_update" : 1490718939773,
    "path" : "~/Dropbox/data-analysis/pending/IFG1R-UTUC/data/tidy.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : true,
    "source_window" : "",
    "type" : "r_source"
}